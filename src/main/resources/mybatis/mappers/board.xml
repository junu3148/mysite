<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">

	<!-- insertBoard -->
	<insert id="insertBoard" parameterType="BoardVO">

	<![CDATA[
		INSERT INTO board 
			(no, title, content, hit, reg_date, user_no)
		VALUES 
			(seq_board_no.nextval , #{title}, #{content}, 0, SYSDATE, #{userNo})
			
	]]>

	</insert>

	<!-- getBoardList -->
	<select id="getBoardList" parameterType="com.javaex.vo.Criteria" resultType="BoardVO">

	<![CDATA[
		select a.no no,
		       b.name name,
		       a.title title,
		       a.content content,
		       a.hit hit,
		       a.regDate regDate,
		       a.userNo userNo
		from (select x.no,
		             x.title,
		             x.content,
		             x.hit,
		             x.regDate,
		             x.userNo,
		             rownum as rn
		      from (select board.no,
		                   board.title,
		                   board.content,
		                   board.hit,
		                   board.reg_date as regDate,
		                   board.user_no as userNo
		            from board
		            order by board.no desc) x
		      where rownum <= #{pageNum} * #{amount}) a
		join users b on a.userNo = b.no
		where a.rn > (#{pageNum}-1) * #{amount}
		order by a.no desc
	]]>

	</select>

	<!-- serchBoardList -->
	<select id="serchBoardList" parameterType="String"
		resultType="BoardVO">

	<![CDATA[
		SELECT a.no,
		       b.name,
		       a.title,
		       a.content,
		       a.hit,
		       a.reg_date AS regDate,
		       a.user_no AS userNo
		FROM board a
		JOIN users b ON a.user_no = b.no
		WHERE title LIKE '%${value}%'
	]]>

	</select>

	<!-- getBoard -->
	<select id="getBoard" parameterType="String"
		resultType="BoardVO">

	<![CDATA[
		SELECT a.no,
		       b.name,
		       a.title,
		       a.content,
		       a.hit,
		       a.reg_date AS regDate,
		       a.user_no AS userNo
		FROM board a
		JOIN users b ON a.user_no = b.no
		WHERE a.no = #{no}
	]]>

	</select>


	<delete id="deleteBoard" parameterType="BoardVO">
	<![CDATA[
	
		delete from board
				where no = #{no}
	
	]]>

	</delete>

	<update id="updateBoard" parameterType="BoardVO">
	<![CDATA[
		update board set  
	            title= #{title},
	            content = #{content}
				where no = #{no}
	
	]]>

	</update>
	
		<update id="hitPlus" parameterType="BoardVO">
	<![CDATA[
		update board set  
	            hit = hit+1
				where no = #{no}
	
	]]>

	</update>





</mapper>
